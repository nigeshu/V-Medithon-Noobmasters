<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOHO CRM Integration Demo | V‚ÄëMedithon</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        .crm-demo { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .crm-demo .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .crm-demo .btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; }
        .crm-demo .btn:hover { background: rgba(255,255,255,0.3); }
        .crm-demo .input { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; }
        .crm-demo .input::placeholder { color: rgba(255,255,255,0.7); }
        .crm-demo .tag { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); }
        .demo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .demo-section { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); }
        .demo-section h4 { margin: 0 0 16px 0; color: white; }
        .demo-form { display: grid; gap: 12px; }
        .demo-form input, .demo-form select, .demo-form textarea { 
            padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); 
            background: rgba(255,255,255,0.1); color: white; 
        }
        .demo-form input::placeholder, .demo-form textarea::placeholder { color: rgba(255,255,255,0.7); }
        .demo-results { background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; margin-top: 16px; font-family: monospace; font-size: 13px; }
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; }
        .status-connected { background: #10b981; }
        .status-disconnected { background: #ef4444; }
        .status-pending { background: #f59e0b; }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container nav">
            <a class="logo" href="index.html">V‚ÄëMedithon</a>
            <nav class="main-nav">
                <a href="ai.html" class="btn btn-outline">AI Chatbot</a>
                <a href="portal.html" class="btn btn-secondary">Portal</a>
                <a href="index.html" class="btn btn-outline">Home</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="section crm-demo">
            <div class="container">
                <h1 class="section-title">ZOHO CRM Integration Demo</h1>
                <p class="section-lead">Experience the power of integrated customer relationship management for healthcare. This demo showcases how ZOHO CRM seamlessly integrates with your healthcare platform.</p>
                
                <div class="demo-grid">
                    <div class="demo-section">
                        <h4>üîê CRM Authentication</h4>
                        <div style="margin-bottom: 16px;">
                            <span class="status-indicator" id="authStatus"></span>
                            <span id="authText">Checking connection...</span>
                        </div>
                        <button class="btn" onclick="connectCRM()">Connect to ZOHO CRM</button>
                        <button class="btn" onclick="disconnectCRM()">Disconnect</button>
                        
                        <div class="demo-results" id="authResults" style="display: none;">
                            <strong>Authentication Results:</strong><br>
                            <div id="authDetails"></div>
                        </div>
                    </div>

                    <div class="demo-section">
                        <h4>üìä CRM Status</h4>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px;">
                            <span class="tag">Leads: <span id="leadCount">0</span></span>
                            <span class="tag">Contacts: <span id="contactCount">0</span></span>
                            <span class="tag">Tasks: <span id="taskCount">0</span></span>
                        </div>
                        <button class="btn" onclick="refreshCRMStats()">Refresh Stats</button>
                    </div>
                </div>

                <div class="demo-grid">
                    <div class="demo-section">
                        <h4>üë• Create New Lead</h4>
                        <form class="demo-form" id="leadForm">
                            <input type="text" id="leadName" placeholder="Full Name" required>
                            <input type="email" id="leadEmail" placeholder="Email Address" required>
                            <input type="tel" id="leadPhone" placeholder="Phone Number" required>
                            <select id="leadSpecialty" required>
                                <option value="">Select Specialty</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Neurology">Neurology</option>
                                <option value="Orthopedics">Orthopedics</option>
                                <option value="Dermatology">Dermatology</option>
                                <option value="Endocrinology">Endocrinology</option>
                            </select>
                            <textarea id="leadNotes" placeholder="Additional Notes" rows="3"></textarea>
                            <button type="submit" class="btn">Create Lead</button>
                        </form>
                        
                        <div class="demo-results" id="leadResults" style="display: none;">
                            <strong>Lead Creation Results:</strong><br>
                            <div id="leadDetails"></div>
                        </div>
                    </div>

                    <div class="demo-section">
                        <h4>üë®‚Äç‚öïÔ∏è Create Doctor Contact</h4>
                        <form class="demo-form" id="doctorForm">
                            <input type="text" id="doctorName" placeholder="Doctor Name" required>
                            <input type="email" id="doctorEmail" placeholder="Email Address" required>
                            <input type="tel" id="doctorPhone" placeholder="Phone Number" required>
                            <select id="doctorSpecialty" required>
                                <option value="">Select Specialty</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Neurology">Neurology</option>
                                <option value="Orthopedics">Orthopedics</option>
                                <option value="Dermatology">Dermatology</option>
                                <option value="Endocrinology">Endocrinology</option>
                            </select>
                            <input type="text" id="doctorDepartment" placeholder="Department" required>
                            <button type="submit" class="btn">Create Contact</button>
                        </form>
                        
                        <div class="demo-results" id="doctorResults" style="display: none;">
                            <strong>Contact Creation Results:</strong><br>
                            <div id="doctorDetails"></div>
                        </div>
                    </div>
                </div>

                <div class="demo-section" style="grid-column: 1 / -1;">
                    <h4>üîç Search & Analytics</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                        <div>
                            <h5 style="margin: 0 0 8px 0;">Search by Specialty</h5>
                            <select id="searchSpecialty" class="demo-form" style="width: 100%;">
                                <option value="">Select Specialty</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Neurology">Neurology</option>
                                <option value="Orthopedics">Orthopedics</option>
                                <option value="Dermatology">Dermatology</option>
                                <option value="Endocrinology">Endocrinology</option>
                            </select>
                            <button class="btn" onclick="searchBySpecialty()" style="margin-top: 8px; width: 100%;">Search</button>
                        </div>
                        
                        <div>
                            <h5 style="margin: 0 0 8px 0;">Lead Analytics</h5>
                            <div style="font-size: 14px; line-height: 1.6;">
                                <div>Conversion Rate: <strong id="conversionRate">0%</strong></div>
                                <div>Avg Response Time: <strong id="avgResponse">0h</strong></div>
                                <div>Total Value: <strong id="totalValue">‚Çπ0</strong></div>
                            </div>
                        </div>
                        
                        <div>
                            <h5 style="margin: 0 0 8px 0;">Quick Actions</h5>
                            <button class="btn" onclick="exportData()" style="width: 100%; margin-bottom: 8px;">Export Data</button>
                            <button class="btn" onclick="generateReport()" style="width: 100%;">Generate Report</button>
                        </div>
                    </div>
                    
                    <div class="demo-results" id="searchResults" style="display: none; margin-top: 16px;">
                        <strong>Search Results:</strong><br>
                        <div id="searchDetails"></div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 32px;">
                    <a href="admin.html" class="btn btn-primary">Go to Admin Dashboard</a>
                    <a href="portal.html" class="btn btn-outline">Back to Portal</a>
                </div>
            </div>
        </section>
    </main>

    <script type="module">
        import { ZohoCRMAuth, ZohoCRMAPI, HealthcareCRM } from './chatbot/zoho-crm-config.js';

        // Global variables
        let auth, crmAPI, healthcareCRM;
        let isConnected = false;

        // Initialize CRM components
        function initCRM() {
            auth = new ZohoCRMAuth();
            crmAPI = new ZohoCRMAPI(auth);
            healthcareCRM = new HealthcareCRM(crmAPI);
            
            updateAuthStatus();
        }

        // Update authentication status display
        function updateAuthStatus() {
            const statusEl = document.getElementById('authStatus');
            const textEl = document.getElementById('authText');
            
            if (auth.isAuthenticated()) {
                statusEl.className = 'status-indicator status-connected';
                textEl.textContent = 'Connected to ZOHO CRM';
                isConnected = true;
            } else {
                statusEl.className = 'status-indicator status-disconnected';
                textEl.textContent = 'Not connected';
                isConnected = false;
            }
        }

        // Connect to ZOHO CRM
        window.connectCRM = function() {
            if (auth.isAuthenticated()) {
                showResult('authResults', 'authDetails', 'Already connected to ZOHO CRM!');
                return;
            }
            
            // For demo purposes, simulate connection
            setTimeout(() => {
                auth.storeTokens('demo_access_token', 'demo_refresh_token', 3600);
                updateAuthStatus();
                showResult('authResults', 'authDetails', 'Successfully connected to ZOHO CRM!\nAccess Token: demo_access_token\nExpires: 1 hour');
                refreshCRMStats();
            }, 1000);
        };

        // Disconnect from ZOHO CRM
        window.disconnectCRM = function() {
            localStorage.removeItem('zoho_access_token');
            localStorage.removeItem('zoho_refresh_token');
            localStorage.removeItem('zoho_token_expiry');
            updateAuthStatus();
            showResult('authResults', 'authDetails', 'Disconnected from ZOHO CRM');
        };

        // Refresh CRM statistics
        window.refreshCRMStats = function() {
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            
            // Simulate API calls
            document.getElementById('leadCount').textContent = Math.floor(Math.random() * 50) + 10;
            document.getElementById('contactCount').textContent = Math.floor(Math.random() * 100) + 20;
            document.getElementById('taskCount').textContent = Math.floor(Math.random() * 30) + 5;
        };

        // Create new lead
        document.getElementById('leadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            
            const leadData = {
                firstName: document.getElementById('leadName').value.split(' ')[0],
                lastName: document.getElementById('leadName').value.split(' ').slice(1).join(' '),
                email: document.getElementById('leadEmail').value,
                phone: document.getElementById('leadPhone').value,
                specialty: document.getElementById('leadSpecialty').value,
                notes: document.getElementById('leadNotes').value
            };
            
            // Simulate API call
            setTimeout(() => {
                const result = `Lead created successfully!\nID: LD_${Date.now()}\nName: ${leadData.firstName} ${leadData.lastName}\nSpecialty: ${leadData.specialty}\nStatus: New`;
                showResult('leadResults', 'leadDetails', result);
                
                // Update stats
                refreshCRMStats();
            }, 1000);
        });

        // Create doctor contact
        document.getElementById('doctorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            
            const doctorData = {
                firstName: document.getElementById('doctorName').value.split(' ')[0],
                lastName: document.getElementById('doctorName').value.split(' ').slice(1).join(' '),
                email: document.getElementById('doctorEmail').value,
                phone: document.getElementById('doctorPhone').value,
                specialty: document.getElementById('doctorSpecialty').value,
                department: document.getElementById('doctorDepartment').value
            };
            
            // Simulate API call
            setTimeout(() => {
                const result = `Contact created successfully!\nID: CT_${Date.now()}\nName: Dr. ${doctorData.firstName} ${doctorData.lastName}\nSpecialty: ${doctorData.specialty}\nDepartment: ${doctorData.department}`;
                showResult('doctorResults', 'doctorDetails', result);
                
                // Update stats
                refreshCRMStats();
            }, 1000);
        });

        // Search by specialty
        window.searchBySpecialty = function() {
            const specialty = document.getElementById('searchSpecialty').value;
            if (!specialty) {
                alert('Please select a specialty');
                return;
            }
            
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            
            // Simulate search
            setTimeout(() => {
                const results = [
                    { name: 'Dr. Priya Sharma', email: 'priya.sharma@clinic.com', phone: '+91-98765-43210' },
                    { name: 'Rajesh Kumar', email: 'rajesh.kumar@health.org', phone: '+91-87654-32109' },
                    { name: 'Meera Patel', email: 'meera.patel@medtech.co', phone: '+91-76543-21098' }
                ];
                
                const resultText = `Found ${results.length} records for ${specialty}:\n\n${results.map(r => `‚Ä¢ ${r.name} (${r.email})`).join('\n')}`;
                showResult('searchResults', 'searchDetails', resultText);
            }, 1000);
        };

        // Export data
        window.exportData = function() {
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            alert('Exporting data to CSV...\nThis would download a file with all CRM data.');
        };

        // Generate report
        window.generateReport = function() {
            if (!isConnected) {
                alert('Please connect to ZOHO CRM first');
                return;
            }
            alert('Generating comprehensive report...\nThis would create a PDF report with CRM analytics.');
        };

        // Helper function to show results
        function showResult(resultId, detailId, content) {
            document.getElementById(resultId).style.display = 'block';
            document.getElementById(detailId).textContent = content;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initCRM();
        });
    </script>
</body>
</html>
